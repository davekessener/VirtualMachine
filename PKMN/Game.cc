#define GAME_MAIN
#include "Game.h"
#undef GAME_MAIN

Game::Game(void) : sprite(NULL), tileset(NULL), x(0), y(0), dx(0), dy(0)
{
}

Game::~Game(void)
{
}

void Game::init(void)
{
	Screen::instance().onQuit(std::bind(&Game::quit, this));

	sprite = new Sprite{};
	tileset = new TileMap(20, 12, 
	{
		0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 
		0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 
		0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 0x044, 0x045, 
		0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 0x084, 0x085, 
		0x0c4, 0x0c5, 0x0c4, 0x0c5, 0x0c4, 0x0c5, 0x0c4, 0x0c5, 0x0c4, 0x0c5, 0x0c4, 0x0c5, 0x0c4, 0x0c5, 0x0c4, 0x0c5, 0x0c4, 0x0c5, 0x0c4, 0x0c5, 
		0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 
		0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 
		0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 
		0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 
		0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 
		0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 
		0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 0x001, 

		0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 
		0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 
		0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 
		0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 
		0x04a, 0x04b, 0x04b, 0x04c, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 
		0x08a, 0x08b, 0x08b, 0x08c, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 
		0x08a, 0x08b, 0x08b, 0x08c, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 
		0x0ca, 0x0cb, 0x0cb, 0x0cc, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 
		0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 
		0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 
		0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 
		0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 
	}
	);
}

void Game::finalize(void)
{
}

void Game::input(int in)
{
	switch(in)
	{
		case Controls::A:
			break;
		case Controls::B:
			break;
		case Controls::X:
			break;
		case Controls::Y:
			break;
		case Controls::UP:
		case Controls::DOWN:
		case Controls::LEFT:
		case Controls::RIGHT:
			sprite->walk(in);
			break;
		case Controls::START:
			break;
		case Controls::SELECT:
			break;
		case Controls::L:
			break;
		case Controls::R:
			break;
		default:
			break;
	}
}

void Game::update(int ms)
{
	sprite->update();
}

void Game::refresh(void)
{
	tileset->render(*sprite);
}

